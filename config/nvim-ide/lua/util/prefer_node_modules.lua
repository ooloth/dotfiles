local get_system_executable_path = require('util').get_system_executable_path

local M = {}

M.prefer_node_modules_executable = function(executable_name)
  -- get the path to the node_modules binary (if it exists)
  local node_modules_path = vim.fn.getcwd() .. '/node_modules/.bin/' .. executable_name
  if vim.fn.executable(node_modules_path) == 1 then
    return node_modules_path
  end

  -- add a lookup table translating the executable name to the Mason package name
  local mason_package_names = {
    eslint = 'eslint-lsp',
    prettier = 'prettier',
    tsserver = 'typescript-language-server',
  }

  -- otherwise, get the path to the Mason binary
  local mason_package_name = mason_package_names[executable_name]
  -- TODO: how to make "nvim-lazyvim" segment dynamic?
  local mason_path = vim.fn.expand('$HOME') .. '/.local/share/nvim-lazyvim/mason/bin/' .. mason_package_name

  if vim.fn.executable(mason_path) == 1 then
    return mason_path
  end

  -- local mason_path = require('mason-registry').get_package(mason_package_name):get_install_path()
  --   .. '/node_modules/.bin/'
  --   .. executable_name

  -- fall back to the systemwide binary
  local system_executable_path = get_system_executable_path(executable_name)
  if vim.fn.executable(system_executable_path) == 1 then
    return system_executable_path
  end

  -- fall back to the original executable name
  return executable_name
end

return M
